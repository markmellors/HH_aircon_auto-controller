import time
from machine import Pin
from ir_tx import Player   # from Peter Hinch's micropython_ir library

IR_TX_PIN = 17
OFF_INTERVAL_SECONDS = 3600 #runs every hour

OFF_PULSES = [
    6076, 7397, 555, 1634, 551, 1651, 557, 1633, 551, 1651,
    557, 1606, 552, 1625, 531, 1625, 559, 1636, 548, 582,
    552, 578, 556, 576, 557, 576, 532, 585, 550, 582,
    553, 550, 557, 577, 531, 1655, 557, 1653, 530, 1654,
    557, 1634, 550, 1626, 557, 1637, 549, 1653, 531, 1660,
    552, 576, 558, 576, 556, 578, 532, 555, 554, 575,
    558, 551, 532, 584, 551, 577, 558, 1636, 550, 1628,
    530, 1628, 558, 1637, 548, 1655, 556, 1636, 550, 1653,
    556, 1635, 553, 577, 557, 578, 530, 587, 549, 554,
    555, 552, 530, 587, 549, 554, 555, 553, 530, 1656,
    557, 1636, 576, 1629, 583, 553, 530, 1657, 582, 1609,
    577, 1630, 580, 1609, 580, 552, 583, 552, 530, 558,
    578, 1631, 528, 557, 579, 551, 585, 553, 529, 557,
    579, 553, 583, 1611, 575, 555, 581, 1630, 531, 1656,
    583, 1608, 553, 1656, 530, 584, 552, 1656, 581, 507,
    552, 1658, 528, 557, 553, 553, 582, 508, 550, 554,
    555, 1638, 549, 581, 555, 1638, 549, 555, 554, 1637,
    550, 582, 554, 1657, 557, 557, 578, 526, 582, 1609,
    580, 525, 531, 1659, 582, 551, 584, 1610, 579, 526,
    530, 1632, 582, 1581, 582, 7361, 528
]

def make_player(pin_no: int) -> Player:
    pin = Pin(pin_no, Pin.OUT, value=0)
    asize = len(OFF_PULSES) + 4
    return Player(pin, asize=asize)

def send_off(player: Player):
    print("Sending OFF IR frame...")
    player.play(OFF_PULSES)
    print("OFF frame sent.")

def main():
    ir_player = make_player(IR_TX_PIN)
    while True:
        send_off(ir_player)
        time.sleep(OFF_INTERVAL_SECONDS)

if __name__ == "__main__":
    main()
